<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrbanMind: Document Filling Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/legal.css">
</head>
<body>
<div id="header-container"></div>

<section class="hero" id="home">
    <div class="hero-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <div class="container hero-content">
        <div class="hero-text fade-in">
            <h1>AI Document Filling Assistant</h1>
            <p>Upload your blank forms and watch as our AI automatically fills them out with the correct information. All processing happens locally on your device.</p>
            <a href="#assistant" class="btn-main">Try Document Assistant</a>
        </div>
        <div class="robot-container fade-in">
            <img src="../img/riter.png" alt="AI Assistant Robot" class="robot-image" style="max-width: 300px;">
        </div>
    </div>
</section>

<section class="security-section">
    <div class="security-bg"></div>
    <div class="container">
        <div class="security-notice fade-in">
            <h3><i class="fas fa-shield-alt"></i> Your Privacy & Security</h3>
            <p><strong>All document processing happens locally in your browser.</strong> Your files never leave your device or get sent to our servers. We don't store any of your personal information or documents.</p>
        </div>
    </div>
</section>

<section class="document-assistant" id="assistant">
    <div class="container">
        <h2 class="sections-heading">Document Filling Assistant</h2>
        <div class="assistant-container">
            <!-- Input Panel -->
            <div class="panel fade-in">
                <div class="panel-header">
                    <h3><i class="fas fa-upload"></i> Upload Documents</h3>
                </div>
                <div class="panel-content">
                    <div class="upload-area" id="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>Upload Blank Forms</h4>
                        <p>Drag & drop your documents here or click to browse files</p>
                        <div class="upload-button">Select Files</div>
                        <input type="file" id="file-input" class="file-input" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" multiple>
                    </div>

                    <div id="uploaded-files">
                        <!-- Uploaded files will appear here -->
                    </div>

                    <div class="document-actions">
                        <button class="document-action" id="process-btn" disabled>
                            <i class="fas fa-magic"></i> Fill Documents Automatically
                        </button>
                    </div>
                </div>
            </div>

            <!-- Output Panel -->
            <div class="panel fade-in">
                <div class="panel-header">
                    <h3><i class="fas fa-file-contract"></i> Filled Documents</h3>
                </div>
                <div class="panel-content">
                    <div class="document-preview">
                        <div class="preview-header">
                            <h4>Document Preview</h4>
                            <span id="document-count">0 documents</span>
                        </div>
                        <div class="preview-content" id="preview-content">
                            <div class="preview-placeholder">
                                <i class="fas fa-file-alt"></i>
                                <p>Upload documents to see them automatically filled out</p>
                            </div>
                        </div>
                    </div>

                    <div class="document-actions">
                        <button class="document-action" id="download-all-btn" disabled>
                            <i class="fas fa-download"></i> Download All Documents
                        </button>
                        <button class="document-action secondary" id="clear-all-btn">
                            <i class="fas fa-trash-alt"></i> Clear All
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="footer">
    <div class="container">
        <h2>Try Our Secure Document Assistant</h2>
        <p>Process your immigration documents safely with our local AI assistant.</p>
        <a href="#assistant" class="btn-footer">Start Filling Documents</a>
    </div>
</footer>

<script>
    fetch('/header.html')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(html => {
            document.getElementById('header-container').innerHTML = html;
        })
        .catch(error => {
            document.getElementById('header-container').innerHTML =
                `<div style="color: red;">Error loading header: ${error.message}</div>`;
        });

    // Document Assistant functionality
    const fileInput = document.getElementById('file-input');
    const uploadArea = document.getElementById('upload-area');
    const uploadedFiles = document.getElementById('uploaded-files');
    const processBtn = document.getElementById('process-btn');
    const downloadAllBtn = document.getElementById('download-all-btn');
    const clearAllBtn = document.getElementById('clear-all-btn');
    const previewContent = document.getElementById('preview-content');
    const documentCount = document.getElementById('document-count');

    let uploadedDocuments = [];
    let filledDocuments = [];

    // File upload handling
    uploadArea.addEventListener('click', () => {
        fileInput.click();
    });

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = 'var(--color-primary-blue)';
        uploadArea.style.backgroundColor = '#f0f4ff';
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.style.borderColor = '#e0e0e0';
        uploadArea.style.backgroundColor = 'transparent';
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.style.borderColor = '#e0e0e0';
        uploadArea.style.backgroundColor = 'transparent';

        if (e.dataTransfer.files.length) {
            handleFileUpload(Array.from(e.dataTransfer.files));
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            handleFileUpload(Array.from(e.target.files));
        }
    });

    function handleFileUpload(files) {
        files.forEach(file => {
            // Validate file type
            const validTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png',
                'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];

            if (!validTypes.includes(file.type)) {
                alert('Please upload PDF, image, or Word documents only.');
                return;
            }

            // Check file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size too large. Please upload files smaller than 10MB.');
                return;
            }

            // Add to uploaded documents
            uploadedDocuments.push(file);
            displayUploadedFile(file);
        });

        // Enable process button if we have documents
        if (uploadedDocuments.length > 0) {
            processBtn.disabled = false;
        }

        updateDocumentCount();
    }

    function displayUploadedFile(file) {
        const fileElement = document.createElement('div');
        fileElement.className = 'uploaded-file';
        fileElement.innerHTML = `
            <div class="file-icon">
                <i class="fas fa-file-pdf"></i>
            </div>
            <div class="file-info">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${formatFileSize(file.size)}</div>
            </div>
            <div class="file-actions">
                <button class="file-action preview" title="Preview">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="file-action remove" title="Remove">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;

        // Remove file functionality
        fileElement.querySelector('.remove').addEventListener('click', () => {
            const index = uploadedDocuments.findIndex(doc => doc.name === file.name);
            if (index !== -1) {
                uploadedDocuments.splice(index, 1);
            }
            fileElement.remove();

            if (uploadedDocuments.length === 0) {
                processBtn.disabled = true;
            }
            updateDocumentCount();
        });

        // Preview file functionality
        fileElement.querySelector('.preview').addEventListener('click', () => {
            previewDocument(file);
        });

        uploadedFiles.appendChild(fileElement);
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' bytes';
        else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
        else return (bytes / 1048576).toFixed(1) + ' MB';
    }

    function updateDocumentCount() {
        const totalDocs = uploadedDocuments.length + filledDocuments.length;
        documentCount.textContent = `${totalDocs} documents`;
    }

    function previewDocument(file) {
        // In a real application, this would show a proper preview
        // For demo, we'll just show a placeholder with file info
        previewContent.innerHTML = `
            <div class="preview-document">
                <div class="document-image">
                    <div style="text-align: center; padding: 20px;">
                        <i class="fas fa-file-pdf" style="font-size: 4em; color: #e0e0e0; margin-bottom: 15px;"></i>
                        <h4>${file.name}</h4>
                        <p>${formatFileSize(file.size)}</p>
                        <p style="margin-top: 20px; color: var(--color-light-text);">Document preview would appear here</p>
                    </div>
                </div>
            </div>
        `;
    }

    // Process documents
    processBtn.addEventListener('click', () => {
        if (uploadedDocuments.length === 0) return;

        // Show processing indicator
        previewContent.innerHTML = `
            <div class="processing-indicator">
                <i class="fas fa-spinner"></i> Processing ${uploadedDocuments.length} documents...
            </div>
        `;

        // Simulate processing delay
        setTimeout(() => {
            processDocuments();
        }, 2000);
    });

    function processDocuments() {
        filledDocuments = [];

        // Process each uploaded document
        uploadedDocuments.forEach((doc, index) => {
            // Simulate AI processing and creating filled version
            const filledDoc = {
                name: `FILLED_${doc.name}`,
                type: doc.type,
                size: doc.size,
                original: doc
            };

            filledDocuments.push(filledDoc);

            // Display filled document after a short delay
            setTimeout(() => {
                displayFilledDocument(filledDoc, index);
            }, index * 500);
        });

        // Clear uploaded documents
        uploadedDocuments = [];
        uploadedFiles.innerHTML = '';
        processBtn.disabled = true;

        // Enable download button
        downloadAllBtn.disabled = false;

        updateDocumentCount();
    }

    function displayFilledDocument(doc, index) {
        const docElement = document.createElement('div');
        docElement.className = 'uploaded-file';
        docElement.style.animationDelay = `${index * 0.1}s`;
        docElement.classList.add('fade-in');
        docElement.innerHTML = `
            <div class="file-icon" style="background-color: var(--color-success);">
                <i class="fas fa-file-check"></i>
            </div>
            <div class="file-info">
                <div class="file-name">${doc.name}</div>
                <div class="file-size">${formatFileSize(doc.size)} â€¢ Completed</div>
            </div>
            <div class="file-actions">
                <button class="file-action preview" title="Preview">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="file-action download" title="Download">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        `;

        // Preview filled document
        docElement.querySelector('.preview').addEventListener('click', () => {
            previewFilledDocument(doc);
        });

        // Download filled document
        docElement.querySelector('.download').addEventListener('click', () => {
            downloadDocument(doc);
        });

        // Add to the uploaded files area (which now shows filled documents)
        uploadedFiles.appendChild(docElement);
    }

    function previewFilledDocument(doc) {
        // Show a simulated filled document
        previewContent.innerHTML = `
            <div class="preview-document">
                <div class="document-image">
                    <div style="text-align: center; padding: 20px; width: 100%;">
                        <div style="background: white; border: 1px solid #e0e0e0; border-radius: 5px; padding: 20px; text-align: left;">
                            <h3 style="color: var(--color-success); margin-bottom: 15px;">
                                <i class="fas fa-check-circle"></i> Completed Document
                            </h3>
                            <p><strong>Document:</strong> ${doc.name}</p>
                            <p><strong>Status:</strong> All fields have been automatically filled</p>
                            <p><strong>Processed:</strong> ${new Date().toLocaleString()}</p>
                            <div style="margin-top: 20px; padding: 15px; background-color: #f9fafc; border-radius: 5px;">
                                <p style="margin: 0; font-style: italic;">This document has been automatically filled with the appropriate information based on its type and purpose.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function downloadDocument(doc) {
        // In a real application, this would download the actual filled document
        // For demo, we'll just show an alert
        alert(`Downloading: ${doc.name}\n\nIn a real application, this would download the completed document.`);
    }

    // Download all documents
    downloadAllBtn.addEventListener('click', () => {
        if (filledDocuments.length === 0) return;

        alert(`Downloading ${filledDocuments.length} completed documents.\n\nIn a real application, this would download all filled documents as a ZIP file.`);
    });

    // Clear all documents
    clearAllBtn.addEventListener('click', () => {
        uploadedDocuments = [];
        filledDocuments = [];
        uploadedFiles.innerHTML = '';
        previewContent.innerHTML = `
            <div class="preview-placeholder">
                <i class="fas fa-file-alt"></i>
                <p>Upload documents to see them automatically filled out</p>
            </div>
        `;
        processBtn.disabled = true;
        downloadAllBtn.disabled = true;
        updateDocumentCount();
    });

    // Mobile menu toggle
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const navMenu = document.querySelector('.nav-menu');

    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            mobileMenuBtn.innerHTML = navMenu.classList.contains('active')
                ? '<i class="fas fa-times"></i>'
                : '<i class="fas fa-bars"></i>';
        });
    }

    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
</script>
</body>
</html>